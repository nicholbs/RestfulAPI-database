CREATE TABLE ski_types ( 
	type_id int NOT NULL, 
	model varchar(255), 
	type varchar(255), 
	temperature varchar(255), 
	grip varchar(255), 
	size varchar(255), 
	weight_class varchar(255), 
	description varchar(255), 
	historical boolean DEFAULT 0, 
	photo_url varchar(255),
	msrp int, 
	PRIMARY KEY(type_id) 
)

CREATE TABLE skis (
	serial_nr int NOT NULL,
	ski_type int NOT NULL,
	manufactured_date date,
	order_assigned int,
	PRIMARY KEY (serial_nr)
)
ALTER TABLE skis ADD CONSTRAINT skis_skitypes_fk FOREIGN KEY(serial_nr) REFERENCES ski_types(type_id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE skis ADD CONSTRAINT skis_orders_fk FOREIGN KEY(order_assigned) REFERENCES orders(order_nr) ON DELETE RESTRICT ON UPDATE CASCADE;
-- Kommentar: vi må tenkte litt på dette

CREATE TABLE employees (
	employee_id int NOT NULL,
	first_name varchar(255),
	last_name varchar(255),
	department ENUM ('customer_rep', 'production_planner', 'storekeeper') NOT NULL,
	PRIMARY KEY (employee_id)
)

CREATE TABLE customers (
	customer_id int NOT NULL,
	name varchar(255),
	start_date date,
	end_date date,
	PRIMARY KEY (customer_id)
)

CREATE TABLE franchises (
	customer_id int NOT NULL,
	shipping_address varchar(255),
	buying_price int,
	PRIMARY KEY (customer_id)
)
ALTER TABLE franchises ADD CONSTRAINT franchises_customer_fk FOREIGN KEY(customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE TABLE stores (
	customer_id int NOT NULL,
	shipping_address varchar(255),
	buying_price int,
	franchise_id int,
	PRIMARY KEY (customer_id)
)
ALTER TABLE stores ADD CONSTRAINT stores_customer_fk FOREIGN KEY(customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE stores ADD CONSTRAINT stores_franchises_fk FOREIGN KEY(franchise_id) REFERENCES franchises(customer_id) ON DELETE RESTRICT ON UPDATE CASCADE;
-- Kommentar: vi må tenke litt på den nederste stores_franchise_fk iforhold t ON

CREATE TABLE team_skiers (
	customer_id int NOT NULL,
	birthdate date,
	club varchar(255),
	skis_per_year int,
	PRIMARY KEY (customer_id)
)
ALTER TABLE team_skiers ADD CONSTRAINT team_skiers_customers_fk FOREIGN KEY(customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE TABLE transporters (
	name varchar(255) NOT NULL,
	PRIMARY KEY (name)
)

CREATE TABLE orders (
	order_nr int NOT NULL,
	ski_type int(11),
	ski_quantity int,
	price int,
	state ENUM ('new', 'open', 'skis-available'),
	customer_id int,
	placed_date date,
	PRIMARY KEY (order_nr)
)
ALTER TABLE orders ADD CONSTRAINT orders_ski_types_fk FOREIGN KEY(ski_type) REFERENCES ski_types(type_id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE orders ADD CONSTRAINT orders_customers_fk FOREIGN KEY(customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE ON UPDATE CASCADE;
-- kommentar: tenk litt på øverste orders_ski_types_fk iforhold til ON

CREATE TABLE order_history (
	order_nr int NOT NULL,
	state ENUM ('new', 'open', 'skis-available'),
	customer_rep int,
	changed_date datetime,
	PRIMARY KEY (order_nr, state)
)
ALTER TABLE order_history ADD CONSTRAINT order_history_orders_fk FOREIGN KEY(order_nr) REFERENCES orders(order_nr) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE order_history ADD CONSTRAINT order_historyemployee_fk FOREIGN KEY(customer_rep) REFERENCES employees(employee_id) ON DELETE RESTRICT ON UPDATE CASCADE;
-- kommentar må tenke litt på order_historyemployee_fk iforhold til ON

CREATE TABLE order_aggregates (
	aggregate_id int AUTO_INCREMENT,
	customer_id int,
	PRIMARY KEY (aggregate_id)
)
ALTER TABLE order_aggregates ADD CONSTRAINT order_aggregates_customer_fk FOREIGN KEY(customer_id) REFERENCES customers(customer_id) ON DELETE RESTRICT ON UPDATE CASCADE;
-- kommentar: må tenkes litt over iforhold til ON

CREATE TABLE shipments (
	shipment_nr int AUTO_INCREMENT,
	recipient varchar(255),
	shipping_address varchar(255),
	scheduled_pickup datetime,
	state ENUM ('ready', 'picked-up'),
	order_nr int,
	transporter varchar(255),
	driver_id int,
	PRIMARY KEY (shipment_nr)
)
ALTER TABLE shipments ADD CONSTRAINT shipments_orders_fk FOREIGN KEY(order_nr) REFERENCES orders(order_nr) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE shipments ADD CONSTRAINT shipments_transporters_fk FOREIGN KEY(transporter) REFERENCES transporters(name) ON DELETE RESTRICT ON UPDATE CASCADE;
-- Vi må tenke litt på shipments_transporters_fk ON

CREATE TABLE production_plans (
	ski_type int NOT NULL,
	day date NOT NULL,
	quantity int NOT NULL,
	PRIMARY KEY (ski_type, day)
)
ALTER TABLE production_plans ADD CONSTRAINT production_plans_ski_types_fk FOREIGN KEY(ski_type) REFERENCES ski_types(type_id) ON DELETE CASCADE ON UPDATE CASCADE;
-- må tenkes over
