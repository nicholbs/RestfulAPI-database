CREATE TABLE ski_types ( 
	type_id int NOT NULL, 
	model varchar(255), 
	type varchar(255), 
	temperature varchar(255), 
	grip varchar(255), 
	size varchar(255), 
	weight_class varchar(255), 
	description varchar(255), 
	historical boolean DEFAULT 0, 
	photo_url varchar(255),
	msrp int, 
	PRIMARY KEY(id) 
)

CREATE TABLE skis (
	serial_nr int NOT NULL,
	ski_type int NOT NULL,
	manufactured_date date,
	order_assigned int,
	PRIMARY KEY (product_nr),
	FOREIGN KEY (ski_type) REFERENCES ski_types(type_id),
	FOREIGN KEY (order_assigned) REFERENCES orders(order_nr)
)

CREATE TABLE employees (
	employee_id int NOT NULL,
	first_name varchar(255),
	last_name varchar(255),
	department ENUM ('customer_rep', 'production_planner', 'storekeeper') NOT NULL,
	PRIMARY KEY (employee_id)
)

CREATE TABLE customers (
	customer_id int NOT NULL,
	name varchar(255),
	start_date date,
	end_date date,
	PRIMARY KEY (customer_id)
)

CREATE TABLE franchises (
	customer_id int NOT NULL,
	shipping_address varchar(255),
	buying_price int,
	PRIMARY KEY (customer_id),
	FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
)

CREATE TABLE stores (
	customer_id int NOT NULL,
	shipping_address varchar(255),
	buying_price int,
	franchise_id int,
	PRIMARY KEY (customer_id),
	FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
	FOREIGN KEY (franchise_id) REFERENCES franchises(customer_id)
)

CREATE TABLE team_skiers (
	customer_id int NOT NULL,
	birthdate date,
	club varchar(255),
	skis_per_year int,
	PRIMARY KEY (customer_id),
	FOREGIN KEY (customer_id) REFERENCES customers(customer_id)
)

CREATE TABLE transporters (
	name varchar(255) NOT NULL,
	PRIMARY KEY (name)
)

CREATE TABLE orders (
	order_nr int NOT NULL,
	ski_type int(11),
	ski_quantity int,
	price int,
	state ENUM ('new', 'open', 'skis-available'),
	customer_id int,
	placed_date date,
	PRIMARY KEY (order_nr),
	FOREIGN KEY (ski_type) REFERENCES ski_types (type_id),
	FOREIGN KEY (customer_id) REFERENCES customers (customer_id)
)

CREATE TABLE order_history (
	order_nr int NOT NULL,
	state ENUM ('new', 'open', 'skis-available'),
	customer_rep int,
	changed_date datetime,
	PRIMARY KEY (order_nr, state),
	FOREIGN KEY (order_nr) REFERENCES orders (order_nr),
	FOREIGN KEY (customer_rep) REFERENCES employees (employee_id)
)

CREATE TABLE order_aggregates (
	aggregate_id int AUTO_INCREMENT,
	customer_id int,
	PRIMARY KEY (aggregate_id),
	FOREIGN KEY (customer_id) REFERENCES customers (customer_id)
)

CREATE TABLE shipments (
	shipment_nr int AUTO_INCREMENT,
	recipient varchar(255),
	shipping_address varchar(255),
	scheduled_pickup datetime,
	state ENUM ('ready', 'picked-up'),
	order_nr int,
	transporter varchar(255),
	driver_id int,
	PRIMARY KEY (shipment_nr),
	FOREIGN KEY (order_nr) REFERENCES orders (order_nr),
	FOREIGN KEY (transporter) REFERENCES transporters(name)
)

CREATE TABLE production_plans (
	ski_type int NOT NULL,
	day date NOT NULL,
	quantity int NOT NULL,
	PRIMARY KEY (ski_type, day),
	FOREIGN KEY (ski_type) REFERENCES ski_types (type_id)
)
